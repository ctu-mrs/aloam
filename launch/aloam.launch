<launch>

  <!-- DEFAULT PARAMETERS AND FRAMES -->
  <arg name="uav_name" default="$(env UAV_NAME)" />
  <arg name="fcu_frame" default="$(arg uav_name)/fcu"/>
  <arg name="lidar_frame" default="$(arg uav_name)/os1_lidar"/>
  <arg name="map_frame" default="$(arg uav_name)/aloam_origin"/>

  <!-- SENSOR PARAMETERS -->
  <arg name="vertical_fov" default="33.2" />
  <arg name="frequency" default="10.0" />

  <!-- FILTRATION PARAMETERS -->
  <arg name="external_preprocessing" default="false" />
  <arg name="min_range" default="0.5" />
  <arg name="max_range" default="30.0" />

  <arg name="standalone" default="$(optenv STANDALONE_LOCALIZATION true)" />
  <arg name="debug" default="$(optenv DEBUG false)" />
  <arg     if="$(eval arg('standalone') or arg('debug'))" name="nodelet" value="standalone" />
  <arg unless="$(eval arg('standalone') or arg('debug'))" name="nodelet" value="load" />
  <arg     if="$(eval arg('standalone') or arg('debug'))" name="nodelet_manager" value="" />
  <arg unless="$(eval arg('standalone') or arg('debug'))" name="nodelet_manager" value="$(arg uav_name)_ouster_nodelet_manager" />
  <arg unless="$(arg debug)" name="launch_prefix" value=""/>
  <arg     if="$(arg debug)" name="launch_prefix" value="debug_roslaunch"/>

  <group ns="$(arg uav_name)">

    <!-- Odometry -->
    <node pkg="nodelet" type="nodelet" name="aloam_slam" args="$(arg nodelet) aloam_slam/AloamSlam $(arg nodelet_manager)" output="screen" launch-prefix="$(arg launch_prefix)">
      <param name="verbose" type="bool" value="true"/>

      <param name="scan_line" type="int" value="16" />

      <param name="uav_name" type="string" value="$(arg uav_name)"/>
      <param name="fcu_frame" type="string" value="$(arg fcu_frame)"/>
      <param name="map_frame" type="string" value="$(arg map_frame)"/>
      <param name="lidar_frame" type="string" value="$(arg lidar_frame)"/>

      <!-- <= 0 for real-time mapping -->
      <param name="mapping_frequency" type="double" value="0.0" />
      <param name="mapping_line_resolution" type="double" value="0.4" />
      <param name="mapping_plane_resolution" type="double" value="0.8" />
      <param name="external_preprocessing" type="bool" value="$(arg external_preprocessing)" />
      <param name="min_range" type="double" value="$(arg min_range)"/>
      <param name="max_range" type="double" value="$(arg max_range)"/>
      <param name="vertical_fov" type="double" value="$(arg vertical_fov)"/>
      <param name="frequency" type="double" value="$(arg frequency)"/>

      <!-- Subscribers -->
      <remap if="$(arg external_preprocessing)" from="~laser_cloud_in" to="os1_cloud_node/points_processed"/>
      <remap unless="$(arg external_preprocessing)" from="~laser_cloud_in" to="os1_cloud_node/points"/>
      <remap from="~orientation_in" to="odometry/orientation"/>

      <!-- Publishers -->
      <remap from="~odom_local_out" to="aloam/odom_local"/>
      <remap from="~path_out" to="aloam/path"/>
      <remap from="~odom_global_out" to="aloam/odom"/>
      <remap from="~map_out" to="aloam/map"/>
      <remap from="~scan_registered_out" to="aloam/scan_registered"/>

    </node>
  </group>

</launch>
