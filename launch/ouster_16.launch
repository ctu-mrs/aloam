<launch>

  <arg name="uav_name" default="$(optenv UAV_NAME)" />
  <arg name="debug" default="false" />
  <arg name="fcu_frame" default="$(arg uav_name)/fcu"/>
  <arg name="sensor_frame" default="$(arg uav_name)/os1_sensor"/>
  <arg name="lidar_frame" default="$(arg uav_name)/os1_lidar"/>
  <arg name="map_frame" default="$(arg uav_name)/aloam_origin"/>
  <arg name="rviz" default="false" />
  <arg name="map_builder" default="true" />

  <arg unless="$(arg debug)" name="launch_prefix" value=""/>
  <arg     if="$(arg debug)" name="launch_prefix" value="gdb -ex run --args"/>

  <group ns="$(arg uav_name)">

    <param name="scan_line" type="int" value="16" />

    <!-- if 1, do mapping 10 Hz, if 2, do mapping 5 Hz. Suggest to use 1, it will adjust frequence automaticlly -->
    <param name="mapping_skip_frame" type="int" value="1" />

    <!-- remove too closed points -->
    <param name="minimum_range" type="double" value="0.5"/>

    <param name="mapping_line_resolution" type="double" value="0.2"/>
    <param name="mapping_plane_resolution" type="double" value="0.4"/>

    <param name="uav_name" type="string" value="$(arg uav_name)"/>
    <param name="map_frame" type="string" value="$(arg map_frame)"/>
    <param name="lidar_frame" type="string" value="$(arg lidar_frame)"/>
    <param name="fcu_frame" type="string" value="$(arg fcu_frame)"/>

    <!-- Odometry node -->
    <node pkg="aloam_velodyne" type="alaserOdometry" name="aloam_odometry" output="screen">

      <!-- Subscribers -->
      <remap from="/sensor_points" to="os1_cloud_node/points"/>

      <!-- Publishers -->
      <remap from="/sensor_cloud_3" to="~sensor_cloud_3"/>
      <remap from="/laser_odom_to_init" to="~laser_odom_to_init"/>
      <remap from="/laser_odom_path" to="~laser_odom_path"/>
      <remap from="/laser_cloud_corner_last" to="~laser_cloud_corner_last"/>
      <remap from="/laser_cloud_surf_last" to="~laser_cloud_surf_last"/>

    </node>

    <!-- Mapping node -->
    <node pkg="aloam_velodyne" type="alaserMapping" name="aloam_mapping" output="screen">

      <!-- Subscribers -->
      <remap from="/sensor_cloud_3" to="aloam_odometry/sensor_cloud_3"/>
      <remap from="/laser_odom_to_init" to="aloam_odometry/laser_odom_to_init"/>
      <remap from="/laser_cloud_corner_last" to="aloam_odometry/laser_cloud_corner_last"/>
      <remap from="/laser_cloud_surf_last" to="aloam_odometry/laser_cloud_surf_last"/>

      <!-- Publishers -->
      <remap from="/sensor_cloud_registered" to="~sensor_cloud_registered"/>
      <remap from="/laser_cloud_map" to="~laser_cloud_map"/>
      <remap from="/laser_cloud_surround" to="~laser_cloud_surround"/>
      <remap from="/aft_mapped_path" to="~aft_mapped_path"/>
      <remap from="/aft_mapped_to_init" to="~aft_mapped_to_init"/>
      <remap from="/aft_mapped_to_init_high_frec" to="~aft_mapped_to_init_high_frec"/>

    </node>

    <!-- Map Builder node -->
    <group if="$(arg map_builder)">
      <include file="$(find aloam_velodyne)/launch/map_builder.launch">
        <arg name="uav_name" value="$(arg uav_name)" />
        <arg name="map_frame" value="$(arg map_frame)" />
      </include>
    </group>


    <!-- Transform node -->
    <!-- <node pkg="nodelet" type="nodelet" name="cloud_transform" args="standalone cloud_transform/CloudTransform" output="screen" launch-prefix="$(arg launch_prefix)" > -->

    <!--   <param name="target_frame" type="string" value="$(arg fcu_frame)" /> -->

    <!--   <!-1- Subscribers -1-> -->
    <!--   <remap from="~cloud_scan_in" to="os1_cloud_node/points" /> -->

    <!--   <!-1- Publishers -1-> -->
    <!--   <remap from="~cloud_transformed_out" to="/velodyne_points/fcu_frame" /> -->

    <!-- </node> -->

    <group if="$(arg rviz)">
      <node launch-prefix="nice" pkg="rviz" type="rviz" name="rviz" args="-d $(find aloam_velodyne)/rviz/uav3.rviz" />
    </group>

  </group>

</launch>
